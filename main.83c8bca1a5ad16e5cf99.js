!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){},function(e,t,s){"use strict";s.r(t),s.d(t,"options",(function(){return p}));s(0);class i{constructor(e){this.getInitialCards=()=>fetch(this.baseUrl+"/cards",{headers:this.headers}).then(e=>this._getResponseData(e)),this.addCardPage=(e,t)=>fetch(this.baseUrl+"/cards",{method:"POST",headers:this.headers,body:JSON.stringify({name:e.value,link:t.value})}).then(e=>this._getResponseData(e)),this.getUsersInfo=()=>fetch(this.baseUrl+"/users/me",{headers:this.headers}).then(e=>this._getResponseData(e)),this.updateUserInfo=(e,t)=>fetch(this.baseUrl+"/users/me",{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(e=>this._getResponseData(e)),this.removeCard=e=>fetch(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers}).then(e=>this._getResponseData(e)),this.setLikeCard=e=>fetch(`${this.baseUrl}/cards/like/${e}`,{method:"PUT",headers:this.headers}).then(e=>this._getResponseData(e)),this.unLikeCard=e=>fetch(`${this.baseUrl}/cards/like/${e}`,{method:"DELETE",headers:this.headers}).then(e=>this._getResponseData(e)),this.addNewAvatar=e=>fetch(this.baseUrl+"/users/me/avatar",{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e.value})}).then(e=>this._getResponseData(e)),this._getResponseData=e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status),this.baseUrl=e.baseUrl,this.headers=e.headers}}class n{constructor(e,t,s,i,n){this.like=()=>{this.iconLikeButtonElement.classList.contains("place-card__like-icon_liked")?this._likeState(!1,this._id).then(e=>{this.likeCounterElement.textContent=e.likes.length,this.iconLikeButtonElement.classList.remove("place-card__like-icon_liked")}).catch(e=>{alert(e)}):this._likeState(!0,this._id).then(e=>{this.likeCounterElement.textContent=e.likes.length,this.iconLikeButtonElement.classList.add("place-card__like-icon_liked")}).catch(e=>{alert(e)})},this.isLiked=()=>{this.likes.some(e=>e._id===this.ownerId)&&this.iconLikeButtonElement.classList.add("place-card__like-icon_liked")},this.setDeleteButton=()=>{this.owner._id===this.ownerId&&(this.iconDeleteButtonElement.style.display="block")},this.openImg=()=>{this._openImageCallback(this._link)},this.remove=()=>{window.confirm("Вы действительно хотите удалить эту карточку?")&&(this._removeCard(this._id),this.removeListeners(),this.placeCard.remove())},this._link=e.link,this._name=e.name,this._id=e._id,this.likes=e.likes,this.owner=e.owner,this.ownerId=t,this._openImageCallback=s,this._removeCard=i,this._likeState=n}create(){return this.placeCard=document.createElement("div"),this.imageElement=document.createElement("div"),this.iconDeleteButtonElement=document.createElement("button"),this.descriptionElement=document.createElement("div"),this.nameElement=document.createElement("h3"),this.iconLikeButtonElement=document.createElement("button"),this.likeContainerElement=document.createElement("div"),this.likeCounterElement=document.createElement("div"),this.placeCard.classList.add("place-card"),this.imageElement.classList.add("place-card__image"),this.imageElement.setAttribute("style","url"),this.imageElement.style.backgroundImage="url("+this._link,this.imageElement.style.cursor="pointer",this.iconDeleteButtonElement.classList.add("place-card__delete-icon"),this.descriptionElement.classList.add("place-card__description"),this.nameElement.classList.add("place-card__name"),this.nameElement.textContent=this._name,this.likeContainerElement.classList.add("place-card__like-container"),this.iconLikeButtonElement.classList.add("place-card__like-icon"),this.likeCounterElement.classList.add("place-card__like-counter"),this.likeCounterElement.textContent=this.likes.length,this.placeCard.append(this.imageElement),this.imageElement.append(this.iconDeleteButtonElement),this.placeCard.append(this.descriptionElement),this.descriptionElement.append(this.nameElement),this.descriptionElement.append(this.likeContainerElement),this.likeContainerElement.append(this.iconLikeButtonElement),this.likeContainerElement.append(this.likeCounterElement),this.isLiked(),this.setDeleteButton(),this.setListeners(),this.placeCard}setListeners(){this.iconLikeButtonElement.addEventListener("click",this.like),this.iconDeleteButtonElement.addEventListener("click",this.remove),this.imageElement.addEventListener("click",this.openImg)}removeListeners(){this.iconLikeButtonElement.removeEventListener("click",this.like),this.iconDeleteButtonElement.removeEventListener("click",this.remove),this.imageElement.removeEventListener("click",this.openImg)}}class r{constructor(e,t){this.addCard=e=>{this._cardsList.append(e)},this.render=()=>{this._cardsArray.forEach(e=>{this.addCard(e)})},this._cardsList=e,this._cardsArray=t}}class o{constructor(e,t){this.isValidate=e=>(e.setCustomValidity(""),e.validity.valueMissing?(e.setCustomValidity(this._errorMessages.valueMissing),!1):e.validity.tooShort||e.validity.tooLong?(e.setCustomValidity(this._errorMessages.tooShort),!1):e.validity.typeMismatch&&"url"===e.type?(e.setCustomValidity(this._errorMessages.typeMismatch),!1):e.checkValidity()),this.inputErrorAdd=e=>{this.errorMessage=this._someForm.querySelector(`#${e.id}-error`),this.errorMessage.textContent=e.validationMessage},this.isFieldValid=e=>{const t=this.isValidate(e);return this.inputErrorAdd(e),t},this.setSubmitButtonState=e=>{e?(this.button.removeAttribute("disabled"),this.button.classList.add("popup__button_valid")):(this.button.setAttribute("disabled","true"),this.button.classList.remove("popup__button_valid"))},this.handlerInputForm=e=>{this.isFieldValid(e.target),this._someForm.checkValidity()?this.setSubmitButtonState(!0):this.setSubmitButtonState(!1)},this.resetErrorsPopup=()=>{this.errors.forEach(e=>e.textContent="")},this.setListeners=()=>{this.errors=this._someForm.querySelectorAll(".error"),this.button=this._someForm.querySelector(".button"),this._someForm.addEventListener("input",this.handlerInputForm)},this._someForm=e,this._errorMessages=t,this.setListeners()}}class a{constructor(e,t){this._popupElement=e,this._closeButton=t,this.close=this.close.bind(this),this.setListeners()}open(){this._popupElement.classList.add("popup_is-opened")}close(){this._popupElement.classList.remove("popup_is-opened")}setListeners(){this._closeButton.addEventListener("click",this.close)}}class l extends a{constructor(e,t,s,i){super(e,s),this.open=()=>{this._clearPopup(),super.open()},this.setListeners=()=>{this._openButton.addEventListener("click",this.open)},this._openButton=t,this._clearPopup=i,this.setListeners()}}class c{constructor(){this.setUserInfo=({name:e,about:t,id:s})=>{this._name=e,this._about=t,this._id=s},this.updateRender=(e,t)=>{e.textContent=this._name,t.textContent=this._about},this.getUserInfo=()=>({name:this._name,about:this._about,id:this._id})}}class h{loadingSpinner(e){this.spinner=document.querySelector(".lds-ring"),e?this.spinner.classList.add("lds-ring_visible"):this.spinner.classList.remove("lds-ring_visible")}}const d={baseUrl:"https://nomoreparties.co/cohort11",headers:{authorization:"3d586cb3-b972-4364-9e4e-d3f459cab5c9","Content-Type":"application/json"}},u=JSON.stringify(d),p=JSON.parse(u);!function(){const e={valueMissing:"Это обязательное поле",tooShort:"Должно быть от 2 до 30 символов",typeMismatch:"Здесь должна быть ссылка"},t=document.querySelector(".root"),s=t.querySelector(".places-list"),d=t.querySelector(".user-info__name"),u=t.querySelector(".user-info__job"),m=t.querySelector(".user-info__edit"),_=t.querySelector(".popup__close_type_profile"),E=t.querySelector(".popup_type_profile"),y=t.querySelector("#edit"),b=t.querySelector(".popup__input_type_user"),f=t.querySelector(".popup__input_type_about"),g=t.querySelector(".user-info__button"),k=t.querySelector(".popup__close_type_card"),v=t.querySelector(".popup_type_card"),S=t.querySelector("#new"),L=[],C=t.querySelector(".popup__close_type_image"),B=t.querySelector(".popup_type_image"),q=t.querySelector(".popup__image"),w=t.querySelector(".popup_type_avatar"),I=t.querySelector("#avatar"),D=t.querySelector(".user-info__photo"),U=t.querySelector(".popup__close_avatar"),P=t.querySelector(".user-info__photo"),M=new r(s,L),x=new l(E,m,_,K),O=new l(v,g,k,K),A=new l(w,D,U,K),R=new a(B,C),j=new o(S,e),F=new o(y,e),V=new o(I,e),T=new c,$=new h,N=new i(p);function J(e){q.src=e,R.open()}function H(e,t){return e?N.setLikeCard(t):N.unLikeCard(t)}function z(e){N.removeCard(e).catch(e=>{console.log(e)})}function G(e){e.reset()}function K(){j.resetErrorsPopup(),F.resetErrorsPopup(),V.resetErrorsPopup(),j.setSubmitButtonState(!1)}function Q(e,t,s){const i=e.querySelector(".popup__button");i.textContent=t?"Загрузка...":s}$.loadingSpinner(!0),N.getInitialCards().then(e=>{M.render(void e.forEach((function(e){const t=new n(e,T._id,J,z,H).create();L.push(t)})))}).catch(e=>{console.log(e)}).finally(()=>{$.loadingSpinner(!1)}),N.getUsersInfo().then(e=>{T.setUserInfo({name:e.name,about:e.about,id:e._id}),T.updateRender(d,u),P.style.backgroundImage=`url(${e.avatar})`}).catch(e=>{console.log(e)}),k.addEventListener("click",()=>{G(S)}),m.addEventListener("click",(function(){const e=T.getUserInfo();b.value=e.name,f.value=e.about,F.setSubmitButtonState(!0)})),S.addEventListener("submit",(function(e){e.preventDefault();const t=S.elements.link,s=S.elements.name;j.setSubmitButtonState(!1),Q(v,!0,"+"),N.addCardPage(s,t).then(e=>{const t=new n(e,T._id,J,z,H);M.addCard(t.create()),Q(v,!1,"+"),G(S),O.close()}).catch(e=>{console.log(e)}).finally(()=>{j.setSubmitButtonState(!0)})})),y.addEventListener("submit",(function(e){e.preventDefault();const t=b.value,s=f.value;Q(E,!0,"Сохранить"),N.updateUserInfo(t,s).then(e=>{T.setUserInfo({name:e.name,about:e.about}),T.updateRender(d,u),Q(E,!1,"Сохранить"),x.close()}).catch(e=>{console.log(e)})})),I.addEventListener("submit",(function(e){e.preventDefault();const t=I.elements.link;Q(w,!0,"Сохранить"),N.addNewAvatar(t).then(e=>{D.style.backgroundImage=`url(${e.avatar})`,Q(w,!1,"Сохранить"),G(I),A.close()}).catch(e=>{console.log(e)}).finally(()=>{V.setSubmitButtonState(!1)})}))}()}]);